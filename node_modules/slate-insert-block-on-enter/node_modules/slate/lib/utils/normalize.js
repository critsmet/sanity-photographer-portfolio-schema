'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _block = require('../models/block');

var _block2 = _interopRequireDefault(_block);

var _document = require('../models/document');

var _document2 = _interopRequireDefault(_document);

var _inline = require('../models/inline');

var _inline2 = _interopRequireDefault(_inline);

var _data = require('../models/data');

var _data2 = _interopRequireDefault(_data);

var _mark = require('../models/mark');

var _mark2 = _interopRequireDefault(_mark);

var _selection = require('../models/selection');

var _selection2 = _interopRequireDefault(_selection);

var _text = require('../models/text');

var _text2 = _interopRequireDefault(_text);

var _warn = require('./warn');

var _warn2 = _interopRequireDefault(_warn);

var _typeOf = require('type-of');

var _typeOf2 = _interopRequireDefault(_typeOf);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Normalize a block argument `value`.
 *
 * @param {Block|String|Object} value
 * @return {Block}
 */

function block(value) {
  if (value instanceof _block2.default) return value;

  switch ((0, _typeOf2.default)(value)) {
    case 'string':
    case 'object':
      return _block2.default.create(nodeProperties(value));

    default:
      throw new Error('Invalid `block` argument! It must be a block, an object, or a string. You passed: "' + value + '".');
  }
}

/**
 * Normalize an inline argument `value`.
 *
 * @param {Inline|String|Object} value
 * @return {Inline}
 */

function inline(value) {
  if (value instanceof _inline2.default) return value;

  switch ((0, _typeOf2.default)(value)) {
    case 'string':
    case 'object':
      return _inline2.default.create(nodeProperties(value));

    default:
      throw new Error('Invalid `inline` argument! It must be an inline, an object, or a string. You passed: "' + value + '".');
  }
}

/**
 * Normalize a key argument `value`.
 *
 * @param {String|Node} value
 * @return {String}
 */

function key(value) {
  if ((0, _typeOf2.default)(value) == 'string') return value;

  (0, _warn2.default)('An object was passed to a Node method instead of a `key` string. This was previously supported, but is being deprecated because it can have a negative impact on performance. The object in question was:', value);
  if (value instanceof _block2.default) return value.key;
  if (value instanceof _document2.default) return value.key;
  if (value instanceof _inline2.default) return value.key;
  if (value instanceof _text2.default) return value.key;

  throw new Error('Invalid `key` argument! It must be either a block, an inline, a text, or a string. You passed: "' + value + '".');
}

/**
 * Normalize a mark argument `value`.
 *
 * @param {Mark|String|Object} value
 * @return {Mark}
 */

function mark(value) {
  if (value instanceof _mark2.default) return value;

  switch ((0, _typeOf2.default)(value)) {
    case 'string':
    case 'object':
      return _mark2.default.create(markProperties(value));

    default:
      throw new Error('Invalid `mark` argument! It must be a mark, an object, or a string. You passed: "' + value + '".');
  }
}

/**
 * Normalize a mark properties argument `value`.
 *
 * @param {String|Object|Mark} value
 * @return {Object}
 */

function markProperties() {
  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var ret = {};

  switch ((0, _typeOf2.default)(value)) {
    case 'string':
      ret.type = value;
      break;

    case 'object':
      for (var k in value) {
        if (k == 'data') {
          if (value[k] !== undefined) ret[k] = _data2.default.create(value[k]);
        } else {
          ret[k] = value[k];
        }
      }
      break;

    default:
      throw new Error('Invalid mark `properties` argument! It must be an object, a string or a mark. You passed: "' + value + '".');
  }

  return ret;
}

/**
 * Normalize a node properties argument `value`.
 *
 * @param {String|Object|Node} value
 * @return {Object}
 */

function nodeProperties() {
  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var ret = {};

  switch ((0, _typeOf2.default)(value)) {
    case 'string':
      ret.type = value;
      break;

    case 'object':
      if (value.isVoid !== undefined) ret.isVoid = !!value.isVoid;
      for (var k in value) {
        if (k == 'data') {
          if (value[k] !== undefined) ret[k] = _data2.default.create(value[k]);
        } else {
          ret[k] = value[k];
        }
      }
      break;

    default:
      throw new Error('Invalid node `properties` argument! It must be an object, a string or a node. You passed: "' + value + '".');
  }

  return ret;
}

/**
 * Normalize a selection argument `value`.
 *
 * @param {Selection|Object} value
 * @return {Selection}
 */

function selection(value) {
  if (value instanceof _selection2.default) return value;

  switch ((0, _typeOf2.default)(value)) {
    case 'object':
      return _selection2.default.create(value);

    default:
      throw new Error('Invalid `selection` argument! It must be a selection or an object. You passed: "' + value + '".');
  }
}

/**
 * Normalize a selection properties argument `value`.
 *
 * @param {Object|Selection} value
 * @return {Object}
 */

function selectionProperties() {
  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var ret = {};

  switch ((0, _typeOf2.default)(value)) {
    case 'object':
      if (value.anchorKey !== undefined) ret.anchorKey = value.anchorKey;
      if (value.anchorOffset !== undefined) ret.anchorOffset = value.anchorOffset;
      if (value.focusKey !== undefined) ret.focusKey = value.focusKey;
      if (value.focusOffset !== undefined) ret.focusOffset = value.focusOffset;
      if (value.isBackward !== undefined) ret.isBackward = !!value.isBackward;
      if (value.isFocused !== undefined) ret.isFocused = !!value.isFocused;
      if (value.marks !== undefined) ret.marks = value.marks;
      break;

    default:
      throw new Error('Invalid selection `properties` argument! It must be an object or a selection. You passed: "' + value + '".');
  }

  return ret;
}

/**
 * Export.
 *
 * @type {Object}
 */

exports.default = {
  block: block,
  inline: inline,
  key: key,
  mark: mark,
  markProperties: markProperties,
  nodeProperties: nodeProperties,
  selection: selection,
  selectionProperties: selectionProperties
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9ub3JtYWxpemUuanMiXSwibmFtZXMiOlsiYmxvY2siLCJ2YWx1ZSIsImNyZWF0ZSIsIm5vZGVQcm9wZXJ0aWVzIiwiRXJyb3IiLCJpbmxpbmUiLCJrZXkiLCJtYXJrIiwibWFya1Byb3BlcnRpZXMiLCJyZXQiLCJ0eXBlIiwiayIsInVuZGVmaW5lZCIsImlzVm9pZCIsInNlbGVjdGlvbiIsInNlbGVjdGlvblByb3BlcnRpZXMiLCJhbmNob3JLZXkiLCJhbmNob3JPZmZzZXQiLCJmb2N1c0tleSIsImZvY3VzT2Zmc2V0IiwiaXNCYWNrd2FyZCIsImlzRm9jdXNlZCIsIm1hcmtzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVBOzs7Ozs7O0FBT0EsU0FBU0EsS0FBVCxDQUFlQyxLQUFmLEVBQXNCO0FBQ3BCLE1BQUlBLGdDQUFKLEVBQTRCLE9BQU9BLEtBQVA7O0FBRTVCLFVBQVEsc0JBQU9BLEtBQVAsQ0FBUjtBQUNFLFNBQUssUUFBTDtBQUNBLFNBQUssUUFBTDtBQUNFLGFBQU8sZ0JBQU1DLE1BQU4sQ0FBYUMsZUFBZUYsS0FBZixDQUFiLENBQVA7O0FBRUY7QUFDRSxZQUFNLElBQUlHLEtBQUoseUZBQWtHSCxLQUFsRyxRQUFOO0FBTko7QUFRRDs7QUFFRDs7Ozs7OztBQU9BLFNBQVNJLE1BQVQsQ0FBZ0JKLEtBQWhCLEVBQXVCO0FBQ3JCLE1BQUlBLGlDQUFKLEVBQTZCLE9BQU9BLEtBQVA7O0FBRTdCLFVBQVEsc0JBQU9BLEtBQVAsQ0FBUjtBQUNFLFNBQUssUUFBTDtBQUNBLFNBQUssUUFBTDtBQUNFLGFBQU8saUJBQU9DLE1BQVAsQ0FBY0MsZUFBZUYsS0FBZixDQUFkLENBQVA7O0FBRUY7QUFDRSxZQUFNLElBQUlHLEtBQUosNEZBQXFHSCxLQUFyRyxRQUFOO0FBTko7QUFRRDs7QUFFRDs7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QVBhO0FBUWJDO0FBUmEsQyIsImZpbGUiOiJub3JtYWxpemUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCBCbG9jayBmcm9tICcuLi9tb2RlbHMvYmxvY2snXG5pbXBvcnQgRG9jdW1lbnQgZnJvbSAnLi4vbW9kZWxzL2RvY3VtZW50J1xuaW1wb3J0IElubGluZSBmcm9tICcuLi9tb2RlbHMvaW5saW5lJ1xuaW1wb3J0IERhdGEgZnJvbSAnLi4vbW9kZWxzL2RhdGEnXG5pbXBvcnQgTWFyayBmcm9tICcuLi9tb2RlbHMvbWFyaydcbmltcG9ydCBTZWxlY3Rpb24gZnJvbSAnLi4vbW9kZWxzL3NlbGVjdGlvbidcbmltcG9ydCBUZXh0IGZyb20gJy4uL21vZGVscy90ZXh0J1xuaW1wb3J0IHdhcm4gZnJvbSAnLi93YXJuJ1xuaW1wb3J0IHR5cGVPZiBmcm9tICd0eXBlLW9mJ1xuXG4vKipcbiAqIE5vcm1hbGl6ZSBhIGJsb2NrIGFyZ3VtZW50IGB2YWx1ZWAuXG4gKlxuICogQHBhcmFtIHtCbG9ja3xTdHJpbmd8T2JqZWN0fSB2YWx1ZVxuICogQHJldHVybiB7QmxvY2t9XG4gKi9cblxuZnVuY3Rpb24gYmxvY2sodmFsdWUpIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQmxvY2spIHJldHVybiB2YWx1ZVxuXG4gIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgIHJldHVybiBCbG9jay5jcmVhdGUobm9kZVByb3BlcnRpZXModmFsdWUpKVxuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBcXGBibG9ja1xcYCBhcmd1bWVudCEgSXQgbXVzdCBiZSBhIGJsb2NrLCBhbiBvYmplY3QsIG9yIGEgc3RyaW5nLiBZb3UgcGFzc2VkOiBcIiR7dmFsdWV9XCIuYClcbiAgfVxufVxuXG4vKipcbiAqIE5vcm1hbGl6ZSBhbiBpbmxpbmUgYXJndW1lbnQgYHZhbHVlYC5cbiAqXG4gKiBAcGFyYW0ge0lubGluZXxTdHJpbmd8T2JqZWN0fSB2YWx1ZVxuICogQHJldHVybiB7SW5saW5lfVxuICovXG5cbmZ1bmN0aW9uIGlubGluZSh2YWx1ZSkge1xuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJbmxpbmUpIHJldHVybiB2YWx1ZVxuXG4gIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgIHJldHVybiBJbmxpbmUuY3JlYXRlKG5vZGVQcm9wZXJ0aWVzKHZhbHVlKSlcblxuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgXFxgaW5saW5lXFxgIGFyZ3VtZW50ISBJdCBtdXN0IGJlIGFuIGlubGluZSwgYW4gb2JqZWN0LCBvciBhIHN0cmluZy4gWW91IHBhc3NlZDogXCIke3ZhbHVlfVwiLmApXG4gIH1cbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgYSBrZXkgYXJndW1lbnQgYHZhbHVlYC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ3xOb2RlfSB2YWx1ZVxuICogQHJldHVybiB7U3RyaW5nfVxuICovXG5cbmZ1bmN0aW9uIGtleSh2YWx1ZSkge1xuICBpZiAodHlwZU9mKHZhbHVlKSA9PSAnc3RyaW5nJykgcmV0dXJuIHZhbHVlXG5cbiAgd2FybignQW4gb2JqZWN0IHdhcyBwYXNzZWQgdG8gYSBOb2RlIG1ldGhvZCBpbnN0ZWFkIG9mIGEgYGtleWAgc3RyaW5nLiBUaGlzIHdhcyBwcmV2aW91c2x5IHN1cHBvcnRlZCwgYnV0IGlzIGJlaW5nIGRlcHJlY2F0ZWQgYmVjYXVzZSBpdCBjYW4gaGF2ZSBhIG5lZ2F0aXZlIGltcGFjdCBvbiBwZXJmb3JtYW5jZS4gVGhlIG9iamVjdCBpbiBxdWVzdGlvbiB3YXM6JywgdmFsdWUpXG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEJsb2NrKSByZXR1cm4gdmFsdWUua2V5XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERvY3VtZW50KSByZXR1cm4gdmFsdWUua2V5XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElubGluZSkgcmV0dXJuIHZhbHVlLmtleVxuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBUZXh0KSByZXR1cm4gdmFsdWUua2V5XG5cbiAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIFxcYGtleVxcYCBhcmd1bWVudCEgSXQgbXVzdCBiZSBlaXRoZXIgYSBibG9jaywgYW4gaW5saW5lLCBhIHRleHQsIG9yIGEgc3RyaW5nLiBZb3UgcGFzc2VkOiBcIiR7dmFsdWV9XCIuYClcbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgYSBtYXJrIGFyZ3VtZW50IGB2YWx1ZWAuXG4gKlxuICogQHBhcmFtIHtNYXJrfFN0cmluZ3xPYmplY3R9IHZhbHVlXG4gKiBAcmV0dXJuIHtNYXJrfVxuICovXG5cbmZ1bmN0aW9uIG1hcmsodmFsdWUpIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTWFyaykgcmV0dXJuIHZhbHVlXG5cbiAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7XG4gICAgY2FzZSAnc3RyaW5nJzpcbiAgICBjYXNlICdvYmplY3QnOlxuICAgICAgcmV0dXJuIE1hcmsuY3JlYXRlKG1hcmtQcm9wZXJ0aWVzKHZhbHVlKSlcblxuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgXFxgbWFya1xcYCBhcmd1bWVudCEgSXQgbXVzdCBiZSBhIG1hcmssIGFuIG9iamVjdCwgb3IgYSBzdHJpbmcuIFlvdSBwYXNzZWQ6IFwiJHt2YWx1ZX1cIi5gKVxuICB9XG59XG5cbi8qKlxuICogTm9ybWFsaXplIGEgbWFyayBwcm9wZXJ0aWVzIGFyZ3VtZW50IGB2YWx1ZWAuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fE1hcmt9IHZhbHVlXG4gKiBAcmV0dXJuIHtPYmplY3R9XG4gKi9cblxuZnVuY3Rpb24gbWFya1Byb3BlcnRpZXModmFsdWUgPSB7fSkge1xuICBjb25zdCByZXQgPSB7fVxuXG4gIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICByZXQudHlwZSA9IHZhbHVlXG4gICAgICBicmVha1xuXG4gICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgIGZvciAoY29uc3QgayBpbiB2YWx1ZSkge1xuICAgICAgICBpZiAoayA9PSAnZGF0YScpIHtcbiAgICAgICAgICBpZiAodmFsdWVba10gIT09IHVuZGVmaW5lZCkgcmV0W2tdID0gRGF0YS5jcmVhdGUodmFsdWVba10pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0W2tdID0gdmFsdWVba11cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYnJlYWtcblxuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWFyayBcXGBwcm9wZXJ0aWVzXFxgIGFyZ3VtZW50ISBJdCBtdXN0IGJlIGFuIG9iamVjdCwgYSBzdHJpbmcgb3IgYSBtYXJrLiBZb3UgcGFzc2VkOiBcIiR7dmFsdWV9XCIuYClcbiAgfVxuXG4gIHJldHVybiByZXRcbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgYSBub2RlIHByb3BlcnRpZXMgYXJndW1lbnQgYHZhbHVlYC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ3xPYmplY3R8Tm9kZX0gdmFsdWVcbiAqIEByZXR1cm4ge09iamVjdH1cbiAqL1xuXG5mdW5jdGlvbiBub2RlUHJvcGVydGllcyh2YWx1ZSA9IHt9KSB7XG4gIGNvbnN0IHJldCA9IHt9XG5cbiAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7XG4gICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgIHJldC50eXBlID0gdmFsdWVcbiAgICAgIGJyZWFrXG5cbiAgICBjYXNlICdvYmplY3QnOlxuICAgICAgaWYgKHZhbHVlLmlzVm9pZCAhPT0gdW5kZWZpbmVkKSByZXQuaXNWb2lkID0gISF2YWx1ZS5pc1ZvaWRcbiAgICAgIGZvciAoY29uc3QgayBpbiB2YWx1ZSkge1xuICAgICAgICBpZiAoayA9PSAnZGF0YScpIHtcbiAgICAgICAgICBpZiAodmFsdWVba10gIT09IHVuZGVmaW5lZCkgcmV0W2tdID0gRGF0YS5jcmVhdGUodmFsdWVba10pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0W2tdID0gdmFsdWVba11cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYnJlYWtcblxuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbm9kZSBcXGBwcm9wZXJ0aWVzXFxgIGFyZ3VtZW50ISBJdCBtdXN0IGJlIGFuIG9iamVjdCwgYSBzdHJpbmcgb3IgYSBub2RlLiBZb3UgcGFzc2VkOiBcIiR7dmFsdWV9XCIuYClcbiAgfVxuXG4gIHJldHVybiByZXRcbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgYSBzZWxlY3Rpb24gYXJndW1lbnQgYHZhbHVlYC5cbiAqXG4gKiBAcGFyYW0ge1NlbGVjdGlvbnxPYmplY3R9IHZhbHVlXG4gKiBAcmV0dXJuIHtTZWxlY3Rpb259XG4gKi9cblxuZnVuY3Rpb24gc2VsZWN0aW9uKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFNlbGVjdGlvbikgcmV0dXJuIHZhbHVlXG5cbiAgc3dpdGNoICh0eXBlT2YodmFsdWUpKSB7XG4gICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgIHJldHVybiBTZWxlY3Rpb24uY3JlYXRlKHZhbHVlKVxuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBcXGBzZWxlY3Rpb25cXGAgYXJndW1lbnQhIEl0IG11c3QgYmUgYSBzZWxlY3Rpb24gb3IgYW4gb2JqZWN0LiBZb3UgcGFzc2VkOiBcIiR7dmFsdWV9XCIuYClcbiAgfVxufVxuXG4vKipcbiAqIE5vcm1hbGl6ZSBhIHNlbGVjdGlvbiBwcm9wZXJ0aWVzIGFyZ3VtZW50IGB2YWx1ZWAuXG4gKlxuICogQHBhcmFtIHtPYmplY3R8U2VsZWN0aW9ufSB2YWx1ZVxuICogQHJldHVybiB7T2JqZWN0fVxuICovXG5cbmZ1bmN0aW9uIHNlbGVjdGlvblByb3BlcnRpZXModmFsdWUgPSB7fSkge1xuICBjb25zdCByZXQgPSB7fVxuXG4gIHN3aXRjaCAodHlwZU9mKHZhbHVlKSkge1xuICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICBpZiAodmFsdWUuYW5jaG9yS2V5ICE9PSB1bmRlZmluZWQpIHJldC5hbmNob3JLZXkgPSB2YWx1ZS5hbmNob3JLZXlcbiAgICAgIGlmICh2YWx1ZS5hbmNob3JPZmZzZXQgIT09IHVuZGVmaW5lZCkgcmV0LmFuY2hvck9mZnNldCA9IHZhbHVlLmFuY2hvck9mZnNldFxuICAgICAgaWYgKHZhbHVlLmZvY3VzS2V5ICE9PSB1bmRlZmluZWQpIHJldC5mb2N1c0tleSA9IHZhbHVlLmZvY3VzS2V5XG4gICAgICBpZiAodmFsdWUuZm9jdXNPZmZzZXQgIT09IHVuZGVmaW5lZCkgcmV0LmZvY3VzT2Zmc2V0ID0gdmFsdWUuZm9jdXNPZmZzZXRcbiAgICAgIGlmICh2YWx1ZS5pc0JhY2t3YXJkICE9PSB1bmRlZmluZWQpIHJldC5pc0JhY2t3YXJkID0gISF2YWx1ZS5pc0JhY2t3YXJkXG4gICAgICBpZiAodmFsdWUuaXNGb2N1c2VkICE9PSB1bmRlZmluZWQpIHJldC5pc0ZvY3VzZWQgPSAhIXZhbHVlLmlzRm9jdXNlZFxuICAgICAgaWYgKHZhbHVlLm1hcmtzICE9PSB1bmRlZmluZWQpIHJldC5tYXJrcyA9IHZhbHVlLm1hcmtzXG4gICAgICBicmVha1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzZWxlY3Rpb24gXFxgcHJvcGVydGllc1xcYCBhcmd1bWVudCEgSXQgbXVzdCBiZSBhbiBvYmplY3Qgb3IgYSBzZWxlY3Rpb24uIFlvdSBwYXNzZWQ6IFwiJHt2YWx1ZX1cIi5gKVxuICB9XG5cbiAgcmV0dXJuIHJldFxufVxuXG4vKipcbiAqIEV4cG9ydC5cbiAqXG4gKiBAdHlwZSB7T2JqZWN0fVxuICovXG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgYmxvY2ssXG4gIGlubGluZSxcbiAga2V5LFxuICBtYXJrLFxuICBtYXJrUHJvcGVydGllcyxcbiAgbm9kZVByb3BlcnRpZXMsXG4gIHNlbGVjdGlvbixcbiAgc2VsZWN0aW9uUHJvcGVydGllcyxcbn1cbiJdfQ==